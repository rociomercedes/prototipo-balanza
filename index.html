<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculadora de Productos</title>
  <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
    #scanner, #pantalla-precio { display: none; }
    #pantalla-precio { margin-top: 20px; }
    input { padding: 5px; margin: 5px; width: 150px; text-align: center; }
    button { padding: 10px 15px; margin: 5px; }
    h2 { margin: 10px 0; }
  </style>
</head>
<body>

  <h1>Calculadora de Productos</h1>
  <div id="scanner"></div>

  <div id="pantalla-precio">
    <h2>Producto Escaneado:</h2>
    <p id="codigo"></p>
    <label>Peso (gramos): </label>
    <input type="number" id="peso" placeholder="ej: 250"><br>
    <label>Precio por kilo: </label>
    <input type="number" id="precio" placeholder="ej: 1200"><br>
    <h3>Total: $<span id="total">0</span></h3>
    <button onclick="volverEscanear()">Volver a escanear</button>
    <button onclick="agregarProducto()">Agregar a la suma</button>
  </div>

  <h2>Suma de productos: $<span id="suma">0</span></h2>

  <script>
    let suma = 0;
    let scanner;

    // Inicializa el esc치ner
    function iniciarScanner() {
      document.getElementById("pantalla-precio").style.display = "none";
      document.getElementById("scanner").style.display = "block";

      scanner = new Html5Qrcode("scanner");
      scanner.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: { width: 250, height: 250 } },
        (decodedText) => {
          mostrarPantallaPrecio(decodedText);
          scanner.stop(); // detener c치mara al escanear
        },
        (error) => { /* ignoramos errores de lectura */ }
      ).catch(err => {
        console.error("Error al iniciar c치mara:", err);
      });
    }

    // Muestra la pantalla de precio
    function mostrarPantallaPrecio(codigo) {
      document.getElementById("scanner").style.display = "none";
      document.getElementById("pantalla-precio").style.display = "block";
      document.getElementById("codigo").innerText = codigo;
      document.getElementById("peso").value = "";
      document.getElementById("precio").value = "";
      document.getElementById("total").innerText = "0";
    }

    // Volver a escanear
    function volverEscanear() {
      scanner.clear();
      iniciarScanner();
    }

    // Agregar producto a la suma
    function agregarProducto() {
      const peso = parseFloat(document.getElementById("peso").value) || 0;
      const precio = parseFloat(document.getElementById("precio").value) || 0;
      const total = (peso / 1000) * precio;
      suma += total;
      document.getElementById("suma").innerText = suma.toFixed(2);
      volverEscanear();
    }

    // Calcular total en vivo
    document.getElementById("peso").addEventListener("input", calcularTotal);
    document.getElementById("precio").addEventListener("input", calcularTotal);

    function calcularTotal() {
      const peso = parseFloat(document.getElementById("peso").value) || 0;
      const precio = parseFloat(document.getElementById("precio").value) || 0;
      const total = (peso / 1000) * precio;
      document.getElementById("total").innerText = total.toFixed(2);
    }

    // Inicia con la c치mara activa
    window.onload = iniciarScanner;
  </script>

</body>
</html>


